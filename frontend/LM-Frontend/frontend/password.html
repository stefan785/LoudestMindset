<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Password</title>
    <link rel="stylesheet" href="style.css">
  </head>
  
  <body>
  
    <div id="content">
      <div id="navigation"></div>
    <form id="myForm">
      <label>Old Password: </label><br />
      <input type="password" id="password_old" /><br /><br />
      <label>New Password: </label><br />
      <input type="password" id="password_1" /><br /><br />

      <label>New Password again: </label><br />
      <input type="password" id="password_2" /><br /><br />

      <button type="button" onclick="sendData()">update password</button>
    </form>
    <div id="notification"></div>
    </div>
  </body>
</html>
<script src="lm_frontend_library.js"></script>
<script>
    checkCookie();
    loadNavigation();
  async function sendData() {
    let passwordOld = document.getElementById("password_old").value;
    let password1 = document.getElementById("password_1").value;
    let password2 = document.getElementById("password_2").value;

    if (password1 != password2) {
      notify("passwords do not match");
      return false;
    }

    //hash passwords
    passwordOld = await getSha256Hash(passwordOld);
    passwordNew = await getSha256Hash(password1);

    let userName = await getNameFromCookieText(document.cookie);
    let link = "/getUserByName/" + userName;
    let user = await fetchFn(link, "GET");

    user.password = passwordNew;

    link = "/updateUser";

    await fetchFn(link, "PUT", passwordOld, user);

    //check if it was succcessful:
    let updateSuccess = await checkLogin(userName, passwordNew);

    if (updateSuccess) {
      notify("password changed");
    } else {
      notify("cannot change password - check entries");
    }
  }
</script>
